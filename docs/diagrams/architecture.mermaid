graph LR
    %% Define styles
    classDef database fill:#a5d8ff,stroke:#1971c2,color:#1e1e1e
    classDef ai fill:#f5d0fe,stroke:#9c36b5,color:#1e1e1e
    classDef ui fill:#ffd8a8,stroke:#e8590c,color:#1e1e1e
    classDef api fill:#b2f2bb,stroke:#2f9e44,color:#1e1e1e
    
    %% Database Services & Initialization
    subgraph DB[Database Services & Init]
        direction LR
        supabaseDB[supabaseDB]
        dbInit(dbInit)
        subgraph Supabase Core
        direction TB
        supabaseMeta[supabaseMeta]
        supabaseStorage[supabaseStorage]
        supabaseAuth[supabaseAuth]
        supabaseAPI[supabaseAPI]
        supabaseStudio[supabaseStudio]
        end
        graphDB[graphDB]
    end

    %% AI Services
    subgraph AI[AI Services]
        direction TB
        ollama[ollama]
        ollamaPull[ollamaPull]
    end
    
    %% API Layer (moved to right side)
    subgraph API[API Layer]
        backendAPI[backendAPI]
    end
    
    %% UI Layer
    subgraph UI[UI Layer]
        openWebUI[openWebUI]
    end
    
    %% Connections / Dependencies
    supabaseDB -- "Depends on DB Started" --> dbInit
    dbInit -- "Runs Custom Initialization SQL" --> supabaseDB
    dbInit -- "Completes Successfully" --> supabaseMeta
    dbInit -- "Completes Successfully" --> supabaseStorage
    dbInit -- "Completes Successfully" --> supabaseAuth
    dbInit -- "Completes Successfully" --> supabaseAPI
    dbInit -- "Completes Successfully" --> supabaseStudio
    dbInit -- "Completes Successfully" --> ollamaPull
    dbInit -- "Completes Successfully" --> openWebUI
    dbInit -- "Completes Successfully" --> backendAPI

    %% Service Inter-dependencies (After db-init)
    supabaseMeta --> supabaseStudio
    supabaseAuth --> supabaseStudio
    supabaseAPI --> supabaseStudio
    supabaseAuth --> backendAPI
    supabaseAPI -- REST --> backendAPI
    supabaseStorage -- Storage --> backendAPI
    graphDB -- Graph --> backendAPI
    ollama -- Models --> backendAPI
    ollamaPull -- "Completes Successfully" --> openWebUI
    ollamaPull -- "Completes Successfully" --> backendAPI
    supabaseStorage -- Storage --> openWebUI
    ollama -- "Depends on Ollama Started" --> ollamaPull


    %% Apply styles
    classDef init fill:#c3fae8,stroke:#12b886,color:#1e1e1e
    class supabaseDB,graphDB database
    class supabaseMeta,supabaseStorage,supabaseAuth,supabaseAPI,supabaseStudio database
    class ollama,ollamaPull ai
    class openWebUI ui
    class backendAPI api
    class dbInit init
